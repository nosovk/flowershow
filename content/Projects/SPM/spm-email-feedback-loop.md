## Задача
получать обратную связь о попадании наших рассылок в спам либо нет.
Способ решения: мы создадим ловушку, которая принимает входящие письма и проверяет какой клик ид в них был. Чтобы проверять, попало ли письмо в спам,  мы будем делать рассылки на собственные ящики на разных почтовых провайдерах. Мы установим пересылку писем со своих ящиков на ловушку. Те письма которые будут распознаны как спам не будут доставлены на ловушку. Те письма которые пройдут через спам фильтр - будут доставлены.

## Реализация
Мы используем CloudFlare email workers - этот механизм получает нам программно получать письма не занимаясь обслуживанием почтовых серверов.
Альтернативное решение - использовать mailgun webhook (позволяет отправлять содержимое писем в виде postback http запроса с body письма).

Получив текст письма, мы парсим его для проверки наличия ссылок. После этого мы в табличку в BQ fbl-email-accepted записываем строку:
time: timestamp; когда мы получили письмо
from: string; емейл с которого получено письмо
to: string; емейл который осуществил пересылку
headers: string; заголовки полученные вместе с письмом (там будут наверняка данные спам анализатора, мы, вероятно, захотим их вывести отдельно)
body-html: string; текст письма в html
body-txt: string; текст письма в txt
clickId: ид клик ид в письме (для связки с отправителем)

Мы осознанно игнорируем attachments внутри письма (просто выкидываем)
Мы понимаем что в письме может не быть clickid - в этом случае вероятно с какого-то момента можно будет не делать запись в BQ (на старте мы делаем запись для каждого полученного письма)
Мы понимаем что в письме может быть несколько clickid, но для нас достаточно взять первый из обнаруженных в письме.

Так же мы хотим создать отдельную табличку в которой мы бы вели списко всех ящиков на которых настроенна пересылка (fbl-emails)

## Итоговый отчет
Для формирования итогового отчета необходимо взять из списка отправленных емейлов только емейлы которые есть в таблице fbl-emails. Далее нужно выбрать те по котормы не будет соответсвтующей записи с clickid в fbl-email-accepted. Таким образом мы будем знать какие письма прошли спам фильтра, а какие нет. Я бы хотел в отчете по письмам которые не прошли фильтр отдельно выводить информацию о том какой домен был использован для треккинга, какая компания и шаблон письма были использованны.
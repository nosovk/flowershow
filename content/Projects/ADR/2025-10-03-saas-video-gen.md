## Концепт
Мы хотим сделать два сайта.

Просто лендинг для сео и продвижения (с посадочными на закупку и т.п.). Он должен лежать в корне домена. К примеру vgen.com. Это набор абсолютно статичных html, без бекенда.

Админ панель, для регистрации и управления задачам. Ее можем положить на поддомен app.vgen.com. Для админ панели мы будем использовать ssr с проверкой session cookie, для контроля доступа к целевым разделам.


## Userstories
Как пользователь я хочу:
### Регистрация\Верификация
иметь возможность зарегистрироваться используя емейл и пароль. Не-верифцированный аккаунт не может залогиниться в системе (при попытке авторизации будет показано сообщение о необходимости верификации). Для верификации я должен зайти в почту, и перейти ссылке для активации. Ссылка работает на протяжение 24х часов. При попытке авторизации или сброса пароля для не-активироанного емейла мне приходит ссылка на активацию аккаунта.
### Сброс пароля
иметь возможность сбросить пароль, в случае если я его забыл. Ожидаю что мне прийдет ссылка на сброс пароля. Ссылка активна в течение 24 часов.

### Авторизация
иметь возможность залогиниться используя логин и пароль, установленный при регистрации.

### Просмотр баланса
иметь возможность увидеть текущий баланс

### Просмотр истории изменений баланса
иметь возможность увидеть когда и как менялся баланс
### Пополнить баланс
иметь возможность пополнить баланс на заданные суммы. К примеру:
10000 токенов 10 usd, 30000 токенов 25 usd, 70000 токенов 50 usd. Мы не предусматриваем подписку на токены.

### Посмотреть список заданий
иметь возможность посмотреть список всех созданных мною заданий в системе.

### Создать новое задание
иметь возможность создать новое задание, выбрав тип модели.

### Редактировать созданное задание
иметь возможность зайти внутрь созданного задания, для загрузки в него материалов (видео, аудио)

### Запустить задание
иметь возможность запустить ранее созданное и отредактированное задание

### Посмотреть статус выполнения задания
иметь возможность посмотреть статус выполнения ранее созданных задач

### Загрузить результат выполнения задания
иметь возможность загрузить результат выполнения задания.

### Перегенерировать выполненное задения
иметь возможность запустить перегенерацию задачи, в случае если результат мне не понравился (без повторной загрузки данных)


## Моки приложения
![vgen-auth.png](./attachments/vgen-auth.png)
![[vgen-dashboard.png]]

![vgen-task.png](./attachments/vgen-task.png)

![vgen-tokens.png](./attachments/vgen-tokens.png)


## Landing
Лендинг должен содержать
- посадочную с информацией о продукте
- страницу terms
- страницу privacy
все страницы должны иметь call to action - перейти на страницу регистрации на продукте

Посадочная страница должна иметь в себе примеры уже сгенерированных дипов (оптимально 5-10 в разных категориях).

Посадочная страница не должна иметь блока с описанием цен, только лишь указание на то, что токены можно купить внутри приложения и какие-то общие слова - недорого и т.п.

Посадочная страница должна иметь ссылку на бота поддержки в телеграмм.

Внутри лендинга должна быть возможность добавлять отдельные страницы при необходимости (делать это при помощи кода, просто лендинг не должен ломаться от такого).

Лендинг не поддерживает многоязычность, он делается только на английском языке.

СЕОшная оптимизация out of scope на этапе MVP.


## APP
Приложение является MPA с поддержкой session based авторизации. Приложение не требует сео или SSR по причине того, что отсутствует доступ для неавторизованных пользователей. Приложение не поддерживает многоязычность. В дизайне приложения мы используем стандартные компоненты, максимально простой, но функциональный дизайн. Мы ничего не верстаем, не делаем каких-либо специальных штук.

### Сохранение данных в DWH (bigquery)
Помимо хранения балансов и данных о пользователях в D1 мы хотим сохранять в BigQuery некоторые данные для дальнейшего анализа.
### пользовательские сессии
при каждой авторизации пользователя я хочу сохранять:
- timestamp
- ip
- geo
- useragent
- action: login/signup, определяет логин это или регистрация
- userid
- email: емейл пользователя в системе
### изменения баланса токенов
каждое изменение баланса или попытка изменения баланса должны быть сохранены в отдельной таблице
- timestamp
- userid
- email
- action: toppup, used, manual
- diff: количество токенов на которое произведено изменение
- old_balance: баланс до транзакции
- new_balance: баланс после транзакции
Важно: тут мы не отражаем попытки оплаты или любые иные финансовые операции - это именно лог изменений количества токенов привязанных к пользователю
### лог запуска генераций
у нас нет доступа к логам апи, но для отладки нам нужно хранить когда какие мы задачи запускали, поэтому нам нужна таблица, где будет указанно когда и какой пользователь какие задачи и с какими ид запускал. Наше апи забывает (то есть удаляет) истекшие задачи, без такого лога у нас будут проблемы.
- timestamp
- userid
- email
- taskid
- task properties: to be defined

## admin api
В связи с тем, что мы не делаем админ панель, нам необходимо иметь возможность руками управлять пользователями и балансами.

Все апи имеют защиту при помощи фиксированного admin-token, который необходимо передавать в authorization header, и он задается в env приложения.

Для этого необходимо два метода:
### изменить статус пользователя
- PUT /api/internal/user {userID: "njknjk", status: "activated|new|blocked"}
метод необходим для того, чтобы можно было руками активировать пользоватлея который не может получить письмо на активацию, или заблокировать пользоватлея, с которым мы более не хотим иметь дел.
### изменить баланс пользователя
- PUT /api/internal/balance {userID: "ndskd", diff: "100|-100"}
метод должен возвращать информацию о старом балансе, изменении и новом итоговом балансе. При помощи метода можно как увеличивать, так и уменьшать количество токенов у пользователя



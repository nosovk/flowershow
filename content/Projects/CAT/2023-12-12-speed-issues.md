# Kent frontend performance
По поводу [документа](https://docs.google.com/spreadsheets/d/1m0e4R_JkdWW8OFeKeVr5ajdrtBGa5_wAuEN6Vd7GnrE/edit#gid=0)
![[2023-12-12-comparsion-table.png]]
Методолгия ресерча: [видео](https://www.loom.com/share/f7f4be2175a445eab5112dce9059f085)

Запрос:
> Суть проблемы заключается в том, что последний проект, который мы запустили. Это Кент генерирует большое количество запросов при инициализации. C этого проекта пользователя, то есть вплоть до того, что э в момент запуска, когда зашло большое количество людей. Э, специалисты. Там вот Soft Games распознали. Это большое количество запросов, как видос. Ну хотя там видно, что это не видос, а просто там по 800 запросов. Э-э генерируется от одного пользователя в момент захода на сайт. Мы провели рельс. Э, и. Ну, видим, что на всех других проектах. Э, эта ситуация гораздо меньше этих запросов отправляются и хотели бы вас попросить э, посмотреть на этот rese. И возможно дать какие-то технические рекомендации с вашей стороны. То есть. Э, наверное, первое, что нас интересует Э на что это глобально может влиять? И второе - это э, Какие потенциально запросы, А можно убрать? Да грубо говоря, Или как это можно оптимизировать, чтобы мы дальше пошли уже к разработчикам с аутгеймс и поставлен не конкретную задачу, потому что вот так вот в прямом, и если поставим задачу. Мы в общем уверены, что они решат наши проблемы, поэтому хотели бы попросить вас. Э, предварительно. Э дать какую-то консультацию, э по вот этим запросам, которые отправляются, э, чтобы понять Вообще Что это за запрос? Э, как их можно там правильно было бы оптимизировать, потому что мы видим, что на каких-то проектах отправляются 100 запросов, вроде бы как раз Что ОК но на последнем там вплоть до 1.000. И Ну нам кажется, это довольно большая проблема.


Озвученные проблемы:
- при запуске продукта большое количество сработки в рейтлимит для новых пользователей. Подозрение на то что причина в большом количестве запросов на бекенд при регистрации.
- в целом, что можно поправить на фронтенде чтобы было меньше запросов


### Инструменты
GTMetrix - весьма неплохой сервис для проведения тестов скорости загрузки. Он выдает весьма неплохую визуализацию происходящего в браузере.

site | connection | geo | report
---| --- | --- | ----
Kent | slow 4g | Canada | https://gtmetrix.com/reports/kent.casino/86iFZbpu/
Daddy | 4g | Brazil | https://gtmetrix.com/reports/daddy.casino/R5lGTYkz/

### Что можно поправить легко:

- Запрос на большой кусок вероятно не используемых данных
Из отчетов к примеру бросается в глаза запрос на урл https://kent.casino/content//wp-json/wp/v2/posts?per_page=100&_fields=acf,id,date,slug,title,content,image,_embedded,_links&context=view&_embed=1&categories=2&lang=ru с фронтенда продукта Kent. Этот запрос является явно запросом к бекенду и скачивает 1 мб мусора в никуда при загрузке главной страницы сайта.
![](https://i.imgur.com/wWiGepM.png)
причем эти данные запрашиваются трижды

- время первого ответа сервера
Помимо этого продукт kent показал медленный начальный ответ сервера. Это может быть как проблема апи, так и не включенный [ARGO Routing](https://www.cloudflare.com/application-services/products/argo-smart-routing/) со стороны cloudflare. Либо может быть что просто нужно серверу больше ресурсов выдать.

- обработка полифилов
Так же видно что запуск в браузере существенно тормозит подгрузка polyfills.
![pi](https://i.imgur.com/AwdKKjD.png)
Возможно стоит либо пересмотреть список требуемых полифилов либо возможно загружать их опционально (есть сервисы plolyfill.io или аналоги)

- Загрузка не существующих ассетов
На странице вызывается большое количество запросов к несуществующим ассетам
![](https://i.imgur.com/8IRMqJ0.png) 
Это либо ошибки, либо просто ненужные запросы.

- неоптимизированные изоображения
![](https://i.imgur.com/rNPsbq1.png)
https://kent.casino/static/images/loyalty/1.png
https://kent.casino/static/images/loyalty/2.png и т.п. к примеру
Эта група картинок сохранена в супер большом размере, их можно кратно ужать.

- множественная загрузка одних и тех же изоображений
![](https://i.imgur.com/qxqY5yz.png)
Картинка маленькая, но загружается 10 раз, вероятно хватило бы одного
https://kent.casino/static/images/currency/lp.svg

- Отложенная загрузка скриптов
Скрипты вроде curacao-licence check либо livechat от хелпдеска имееет смысл загружать после первого взаимодействия пользователя (скролл, клик и т.п.)

- Яндекс метрика
стоит убрать

- Запросы к несуществующим апи методам
![](https://i.imgur.com/onmNI0U.png)
Скорее всего этот функционал загружен и на клиенте, но на бекенде отсутвует на этом продукте. Из чего можно предположить что можно уменьшит размер подргружаемого банлда.

- множественные запросы за одними и теми же данными
![](https://i.imgur.com/alTJlus.png)
Запрос на получение списка джекпотов, так же как и последних победителей просиходит каждую пару секунд. Но данные по списку джекпотов не меняются, приходит один и тот же списко джекпотов. Возможно имеет смысл опрашивать обновленный список джекпотов и последних победителей с меньшей периодичностью.
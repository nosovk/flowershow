[EN original](./Tech)

# Olo

Само мобильные приложение : 

написанно на Flutter  

Integrated SDKs:
- Firebase Auth

Пуши:
- OneSignal
- Firebase Cloud Messaging
- VoIP pushes for IOS

Аналитика:
- Apphud
- Firebase Analytics
- Amplitude
- AppsFlyeer

Виоедстрим:
- Agora
- Twilio  

Бэкэнд :  
- Hasura 
- NodeJs + Fastify

Вэб клиент:  
- SvelteKit

  
Функциональные блоки: 

- Админка 

- Баланс

- реклама 

- биллинг 

- черный список 

- чат

- лог событий

- Избранное 

- галлерея

- подарок

- Взаимодействие 

- mission_control

- нотификашки

- панель

- платежи

- профиль

- настройки

- timetable

- Клиент 

- Видео

  

Баланс

Здесь мы сохраняем все,

что касается баланса. Фактически мы используем источник событий для всех

изменений, связанных с балансами. Также для мобильного приложения мы

предоставляем поток событий, связанных с балансом. Это позволяет показывать

пользователям актуальный баланс.

Реклама

Этот домен используется

для хранения данных об атрибуции и возврате от рекламных интеграций. Теперь у

нас интегрированы данные от AppsFlyer и возвращение от Snapchat.

Биллинг

Здесь мы сохраняем тарифы и правила расчета для видеозвонков. Биллинг полностью динамичен, и мы можем легко менять его на лету. Например, для звонков от пользователя к триммеру в рулетке есть отдельный тариф, где за подключение пользователя взимается 9 монет, через 20 секунд остальные 60 монет, через 1 минуту еще 60 монет и так далее. Для стримера есть разные контрольные точки и количество монет. Через 20 секунд стример получит 30 монет, через 60 секунд следующие 30 монет будут засчитаны на счет стримера и так далее.

Блокировка пользователей (Blocklist):

Время от времени пользователи хотят добавить других пользователей в черный список. Причины могут быть разными.

Если пользователь блокирует кого-то, мы немедленно удаляем заблокированного пользователя из звонков, галереи и т.д. Также мы сохраняем причину дополнительного анализа.

Например, мы можем наложить штраф на стримера за непристойность, или, если есть много блокировок из-за притязаний, мы можем заблокировать пользователя.

Чат (Chat):

Этот домен предоставляет решение для обмена сообщениями между пользователями.

В чате также показываются подарки, прямые и рулеточные звонки.

Есть дополнительные механизмы для автоматического добавления пользователей в чат. К примеру, при вводе в эксплуатацию пользователь автоматически начинает чат с некоторыми стримерами. Рулеточные звонки также создают записи в чате.

Журнал событий (Event Log):

Это наша система обмена сообщениями между приложениями, которая используется для хранения событий.

Другие домены могут подписываться на эти события. К примеру, домен AD подписан на событие “user_sign_up” и посылает данные в Snapchat о новой регистрации.

Избранное (Favorites):

Этот домен обеспечивает функциональность выбранного и фолловеров пользователям.

Галерея (Gallery):

Для каждого пользователя мы создаем личную ленту партнеров.

Для разных ролей эти ленты строятся по разным правилам.

Например, мужчины видят стримеров, которые онлайн и тех, кто дольше онлайн, показывают первыми. Но стримеры видят ленту в обратном направлении.

Подарки (Gift):

Пользователи могут отправлять друг другу подарки. Подарки стоят деньги, и стримеры также получают выгоды от подарков.

Взаимодействие (Interaction):

Этот специальный домен отслеживает взаимодействие между пользователями.

Он может быть полезен для анализа поведения пользователей, взаимодействия в чате, обмена подарками и т.д.

Контроль миссий (Mission Control):

Этот домен используется для поддержки панели администратора.

Здесь у нас есть методы для неограниченного запроса данных, управления ролями пользователей, выплатами, агентствами.

Уведомления (Notification):

У вас есть внутренние уведомления в приложении и уведомления через push-сообщения.

Некоторые виды уведомлений доставляются только в приложении, но вы также используете стратегию резервного варианта. Если пользователь не находится в сети или мы не получили подтверждение (ACK) от телефона, мы отправляем push-сообщение.

Для уведомлений о звонках на устройствах Apple вы используете специальные voip-уведомления.

Панель (Panel):

Этот домен используется для работы с сегментацией пользователей на когорты, группы и т.д.

Когорты используются для обозначения пользователей тегами, улучшающими генерацию ленты в галерее и других местах.

Платежи (Payment):

Здесь вы управляете ценами, продуктами и намерениями платежей.

Вы уже интегрировались с платежами Apple и Google. Также у вас есть интеграция подписок (хотя она не была одобрена Apple и не запущена в продакшне).

Профиль (Profile):

Этот домен отвечает за пользовательские данные и разделение частных и публичных данных профиля.

Настройки (Settings):

Глобальные настройки приложения, такие как минимальная допустимая версия для мобильных приложений.

Расписание (Timetable):

Это не отдельный домен, а плагин для хранения и запуска задач cron в вашем приложении.

Пользователь (User):

Здесь мы управляем сеансами пользователей, их статусом "онлайн/офлайн", токенами

Видеозвонки

Этот домен отвечает за видеовызовы, предварительно записанные видео и рулетку. Это достаточно сложный домен, где мы отправляем запросы на звонок, управляем таймаутами звонков и отключаем пользователей.

  
  
  
**
На данный момент у нас есть hyper-v хост с 3 vm. Одна VM, одно окружение
Задача: перейти от dockerized env к manual deployment. Организовать self-servise для управления бекапами.
План:
- удалить не используемый VM со стороны клиента (2е из трех)
- создать новую VM без средств защиты вроде port-knoking etc (клиент должен иметь возможность подключаться к машине, средства защиты препятствуют этому), но хотя бы с fail2ban.
- Для новой VM взять url bizol-pim.com
- На новой VM поднять руками через systemd запуск nginx, maria, php (https://pimcore.com/docs/pimcore/10.4/Development_Documentation/Installation_and_Upgrade/System_Setup_and_Hosting/Nginx_Configuration.html)
- Перенести с оставшейся vm данные на новую VM
- На хост системе установить veam backup (для одной vm он бесплатен) и подключить бекапириование на сам сервер (в бесплатной версии veam бекапирование на S3 like к примеру на digital ocean space клиента не доступен)
- Настроить индексирование бекапируемой VM со стороны veam (и проверить что индекс доступен)
- Настроить выключение бд на время бекапирования при помощи pre-backup\post-backup scripts в veam (https://www.veeam.com/blog/backing-up-mysql-on-a-linux-vm.html)
- Провести тестовое бекапирование и востановлением из бекапаа
- Проверить что после переноса не поломался функционал загрузки файлов\assets в новый pim.
В итоге у нас должен получится новый PIM по новому урлу
Критерии приемки задачи:
У нас должно быть два ПИМ, старый https://ft.bizol-pim.com/ со всеми данными клиента и новый https://bizol-pim.com/ уже без докера с данными со старого. Функционал обоих окружений должен быть идентичным.
Должен быть сделан тестовый бекап и восстановление из него.

Задача 2.
После завершения работ ft окружение можно удалить. Вместо него нужно поднять еще одно окружение аналогичное production и опубликовать его на FT.
- удалить старый ft env
- создать новую VM
- для новой vm настроить среду аналогично prod vm
- скопировать прод окружение на новый FT
Критерии приемки задачи:
на ft окружении должен быть сетап пима аналогичный production (без docker etc). Фичер не бекапится и есть средой для тестрования возможностей пим.

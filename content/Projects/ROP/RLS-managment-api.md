Цель: предоставить оператору возможность видеть статусы, статистику аппаратов, а так же производить несложные управляющие операции (payout, disable, reboot).

Я как оператор хочу иметь возможность видеть аппаратные счетчики устройств. Я как оператор хочу иметь возможность включать\выключать свои игровые аппараты. Так же, я хочу иметь возможность увидеть какой игрок играет на аппарате, а так же иметь возможность принудительно сделать cashout и выгнать игрока, или перезагрузить аппарат.

::: Radoslav :::

Для этого со стороны аппарата необходимо реализовать управляющий топик, к примеру `{machine-id}/in/system-command/`. При отправке в этот топик сообщения вида:
```json

{
  command: "reboot" // restart, payout, machine-disable, machine-enable, menu-open, menu-close
}
```
аппарат должен выполнять целевое действие

- `reboot` — перезагрузить ос нашего устройства
- `payout` — выплатить баланс
- `machine-disable` — сделать аппарат не доступным
- `machine-enable` — сделать аппарат доступным
- `calibrate`  — запустить калибрацию экрана
- service-start - перейти в сервисный режим
- service-end - выйти из сервисного режима.

::: krk :::

Со стороны API rls нам понадобится набор новых апи методов.

Во-первых, нам понадобится новая сущность для доступа к managment-api. К примеру managment-api user, у которого должны быть настойки прав + настройки выборки аппаратов.

Я бы предложил добавить в конфиг лобби новый раздел:
```yaml
managment-api:
	users:
		viva:
			permission: all
			filter:
		      - game_collection:
		          eq: 3CO
		        serial:
		          regex: "^02000000000000[0-4][0-9a-fA-F]$"
		        manufacturer:
		          eq: 'EGT'
			  key: "ewndjk23fkjn43frf"
```
С этим апи ключом нам должно быть доступно несколько методов:
- GET /manage/machines/ 
  этот метод должен работать аналогично обычному методу получения списка аппаратов, но с функционалом фильтрации согласно настройкам ключа. Так же должны отображаться все возможные статусы аппаратов (в том числе выключено), и ид активного игрока и сессии.
- GET /manage/machine/[device-id]
  этот метод должен возвращать нам информацию по устройству, все содержимое systeminfo + текущий статус аппарат (busy, disabled etc), ид текущего игрока и игровой сессии, показания счетчиков с аппарата
- POST /manage/machine/[device-id]/command
  этот метод должен принимать команду для смены состояния аппарата, которая должна быть завязана на топик с аппаратами.


Со стороны ROP нам необходимо создать новую роль: engineer, которая должна иметь доступ в раздел machines. Внутри него у нас должен быть экран со списком аппаратов и их состояниями (кто играет, статусы). При нажатии на аппарат можно провалится в его настройки.

## Service Mode
Для работы с аппаратом необходимо иметь сервисный режим. Некоторая проблема есть в том, что в аппарате на самом деле несколько разных сервисных режимов + в части случаев для действий в сервисном режиме необходимо использовать физические кнопки, которые мы обычно не используем в игре.

Список сервисных кнопок:
- cashout - эта кнопка делает вывод денег из игры, не закрывая игровую сессию. То есть снимает деньги с баланса игры, но не делает следующую ставку. В игре нам эта опция не нужна, т.к. всегда можно просто выйти из игры. Но в сервисном режиме она работает как Ок.
- take_win - это кнопка конца игры, вывести деньги со счета аппарата. В обычном режиме мы нажимаем ее сами при конце сессии. В сервисном режиме она большей частью работает как кнопка Назад.
- service - это кнопка аппарата, с названием сервис. Выполняет функцию сохранения на EGT аппаратах.

Для работы с сервисными режимами предлагается ввести новый статус аппарата - service и несколько дополнительных статусов, как-то service-menu, service-etc.

Перевод аппарата в сервисный режим осуществляется при помощи отдельного административного апи метода. (service-start).  При получении этой команды, аппарат должен выполнить payout и завершить активную игровую сессию если таковая имеется (важно: принудительный payout должен быть отдельно помечен, что это админ действие в BQ (действия админов влияющие на баланс должны быть аудируемыми)). При этом в status аппарата записывается новый, специальный статус - service. В этом режиме аппарат не показывается в лобби, но показывается в списке аппаратов в админ интерфейсе.

После этого нам необходима отдельная опция - подключиться к аппарату в сервисном режиме (как create-session, но другая). В этом режиме нам необходимо вывести дополнительные кнопки, перечисленные выше. Важно: эти кнопки не должны быть доступны в обычном режиме, только в сервисном режиме.

Открытие сервисного меню в сервисном режиме осуществляется магическими комбинациями кнопок, так же как и переключение разных режимов внутри. При переходе в один из специальных сервисных режимов аппарат произведет изменение статуса на service-menu, service-calibration или иной, но обязательно префиксированный словом service.

Важно: команду service-end  можно выполнить только в общем сервисном режиме. Ее выполнение к примеру в service-menu не должно осуществляться. Выход из вложенного сервисного меню должен быть осуществлен при помощи магических действий, и аппарат сам подтвердит выход, сменив статус на обычный service, без деталей о конкретном состоянии.

